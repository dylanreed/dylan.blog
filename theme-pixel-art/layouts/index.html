{{ define "main" }}
<div class="posts-container">
    <div class="posts single-post-view">
        {{ $posts := where .Site.RegularPages "Type" "post" }}
        {{ range $index, $page := $posts }}
        <article class="post {{ partial "category-class.html" . }}" data-post-index="{{ $index }}" {{ if ne $index 0 }}style="display: none;"{{ end }}>
            {{/* Sprite based on first category */}}
            {{ partial "post-sprite.html" . }}

            <div class="post-body">
                {{/* Category tag - links to category page */}}
                {{ with .Params.categories }}
                    {{ range first 1 . }}
                    <a href="/categories/{{ . | urlize }}/" class="post-tag">{{ . }}</a>
                    {{ end }}
                {{ end }}

                {{/* Post title - only show if exists */}}
                {{ if .Title }}
                <h2 class="post-title">
                    <a href="{{ .Permalink }}">{{ .Title }}</a>
                </h2>
                {{ end }}

                {{/* Post date */}}
                <div class="post-meta">{{ .Date.Format "January 2, 2006" }}</div>

                {{/* Excerpt or full content for short posts */}}
                <div class="post-excerpt">
                    {{ if .Summary }}
                        {{ .Summary | plainify | truncate 200 }}
                    {{ else }}
                        {{ .Content | plainify | truncate 200 }}
                    {{ end }}
                </div>

                <a href="{{ .Permalink }}" class="post-link">Read more &rarr;</a>
            </div>
        </article>
        {{ end }}
    </div>

    {{/* Navigation arrows */}}
    <nav class="post-nav-arrows">
        <button class="nav-arrow nav-arrow-left" id="prevPost" disabled aria-label="Previous post">&larr;</button>
        <span class="post-counter"><span id="currentPostNum">1</span> / <span id="totalPosts">{{ len $posts }}</span></span>
        <button class="nav-arrow nav-arrow-right" id="nextPost" aria-label="Next post">&rarr;</button>
    </nav>
</div>

<script>
(function() {
    const posts = document.querySelectorAll('.single-post-view .post');
    const prevBtn = document.getElementById('prevPost');
    const nextBtn = document.getElementById('nextPost');
    const currentNum = document.getElementById('currentPostNum');
    const totalPosts = posts.length;
    let currentIndex = 0;

    function showPost(index) {
        posts.forEach((post, i) => {
            post.style.display = i === index ? 'flex' : 'none';
        });
        currentNum.textContent = index + 1;
        prevBtn.disabled = index === 0;
        nextBtn.disabled = index === totalPosts - 1;
    }

    prevBtn.addEventListener('click', function() {
        if (currentIndex > 0) {
            currentIndex--;
            showPost(currentIndex);
        }
    });

    nextBtn.addEventListener('click', function() {
        if (currentIndex < totalPosts - 1) {
            currentIndex++;
            showPost(currentIndex);
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
            currentIndex--;
            showPost(currentIndex);
        } else if (e.key === 'ArrowRight' && currentIndex < totalPosts - 1) {
            currentIndex++;
            showPost(currentIndex);
        }
    });
})();
</script>
{{ end }}
