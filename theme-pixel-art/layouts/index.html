{{ define "main" }}
<div class="posts-container">
    <div class="posts">
        {{/* Get posts - try "post" type first (micro.blog), fall back to "posts" section (local) */}}
        {{ $posts := where .Site.RegularPages "Type" "post" }}
        {{ if not $posts }}
            {{ $posts = where .Site.RegularPages "Section" "posts" }}
        {{ end }}
        {{ if not $posts }}
            {{ $posts = .Site.RegularPages }}
        {{ end }}

        {{ range $index, $page := first 7 $posts }}
        <article class="post {{ partial "category-class.html" . }}{{ if eq $index 0 }} featured-post{{ end }}">
            {{/* Sprite based on first category */}}
            {{ partial "post-sprite.html" . }}

            <div class="post-body">
                {{/* Category tag - links to category page */}}
                {{ with .Params.categories }}
                    {{ range first 1 . }}
                    <a href="/categories/{{ . | urlize }}/" class="post-tag">{{ . }}</a>
                    {{ end }}
                {{ end }}

                {{/* Post title - only show if exists */}}
                {{ if .Title }}
                <h2 class="post-title">
                    <a href="{{ .Permalink }}">{{ .Title }}</a>
                </h2>
                {{ end }}

                {{/* Post date */}}
                <div class="post-meta">{{ .Date.Format "January 2, 2006" }}</div>

                {{/* First post: summary. Rest: just title and date */}}
                {{ if eq $index 0 }}
                <div class="post-excerpt">
                    {{ if .Summary }}
                        {{ .Summary | plainify | truncate 200 }}
                    {{ else }}
                        {{ .Content | plainify | truncate 200 }}
                    {{ end }}
                </div>
                <a href="{{ .Permalink }}" class="post-link">Read more &rarr;</a>
                {{ end }}
            </div>
        </article>
        {{ end }}
    </div>
</div>
{{ end }}
