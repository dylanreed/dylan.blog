{{ define "main" }}
{{/* Get the category/term name */}}
{{ $term := .Data.Term }}

{{/* Create a fake context for the sprite partial */}}
{{ $spriteContext := dict "Params" (dict "categories" (slice $term)) "isArchive" false }}

<div class="archive-container">
    {{/* Category header with sprite */}}
    <header class="category-header">
        <div class="category-sprite-large">
            {{ partial "post-sprite.html" $spriteContext }}
        </div>
        <h1 class="category-title">{{ $term | title }}</h1>
        <p class="category-count">{{ len .Pages }} {{ if eq (len .Pages) 1 }}post{{ else }}posts{{ end }}</p>
    </header>

    {{/* Group posts by year like archive */}}
    {{ $years := .Pages.GroupByDate "2006" }}

    {{ range $years }}
    <section class="archive-year">
        <h2 class="year-header">{{ .Key }}</h2>
        <ul class="archive-list">
            {{ range .Pages }}
            <li class="archive-entry {{ partial "category-class.html" . }}">
                {{ partial "post-sprite.html" (dict "Params" .Params "isArchive" true) }}

                <span class="archive-date">{{ .Date.Format "Jan 02" }}</span>
                <a href="{{ .Permalink }}" class="archive-title">
                    {{ if .Title }}{{ .Title }}{{ else }}{{ .Content | plainify | truncate 50 }}{{ end }}
                </a>
            </li>
            {{ end }}
        </ul>
    </section>
    {{ end }}
</div>
{{ end }}
